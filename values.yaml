jenkins: # Рівень 0
  controller: # Рівень 1 (все вкладено сюди)
    image:
      registry: "docker.io"
      repository: "jenkins/jenkins"
      tag: "2.479.1-jdk21"
    resources:
      requests:
        cpu: "200m"
        memory: "1Gi"
      limits:
        cpu: "2000m"
        memory: "2Gi"
    
    # Контейнери ініціалізації (Рівень 2)
    # NOTE: Jenkins subchart expects `customInitContainers` (not `initContainers`)
    customInitContainers:
      - name: copy-dsl-scripts
        image: busybox:1.36.1
        imagePullPolicy: IfNotPresent
        resources:
          requests:
            cpu: "50m"
            memory: "128Mi"
          limits:
            cpu: "100m"
            memory: "256Mi"
        command: 
          - "sh"
          - "-c"
          - |
            mkdir -p /var/jenkins_home/dsl_scripts
            cp -v /tmp/scripts/*.groovy /var/jenkins_home/dsl_scripts/
            ls -l /var/jenkins_home/dsl_scripts
        volumeMounts:
          - name: jenkins-home
            mountPath: /var/jenkins_home
          - name: scripts-source
            mountPath: /tmp/scripts

    # Плагіни (Рівень 2)
    installPlugins:
      - kubernetes
      - workflow-aggregator
      - git
      - configuration-as-code
      - job-dsl
      - matrix-auth
      - role-strategy
      - folder-properties
      - validating-string-parameter

    # Secrets from existing Kubernetes Secret, available in JCasC as:
    # ${jenkins-test-creds-test-token}, ${jenkins-test-creds-test-login}, ${jenkins-test-creds-test-password}
    additionalExistingSecrets:
      - name: jenkins-test-creds
        keyName: test-token
      - name: jenkins-test-creds
        keyName: test-login
      - name: jenkins-test-creds
        keyName: test-password

    # Налаштування як код (Рівень 2)
    JCasC:
      defaultConfig: true
      configScripts:
        credentials: |
          credentials:
            system:
              domainCredentials:
                - domain:
                    name: "global"
                    specifications: []
                  credentials:
                    - string:
                        id: "test-token"
                        scope: GLOBAL
                        secret: "${jenkins-test-creds-test-token}"
                    - usernamePassword:
                        id: "test-login"
                        scope: GLOBAL
                        username: "${jenkins-test-creds-test-login}"
                        password: "${jenkins-test-creds-test-password}"
        jobs: |
          jobs:
            - file: "/var/jenkins_home/dsl_scripts/setup.groovy"

  # Додаткові томи (Рівень 1) — Jenkins subchart reads these from `persistence.volumes`
  persistence:
    volumes:
      - name: scripts-source
        configMap:
          name: jenkins-external-jobs